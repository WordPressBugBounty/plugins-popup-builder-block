(()=>{"use strict";var e={n:t=>{var o=t&&t.__esModule?()=>t.default:()=>t;return e.d(o,{a:o}),o},d:(t,o)=>{for(var r in o)e.o(o,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:o[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=function(e,t,o){let r=`${e}=${t}; path=/`;if(o){const e=new Date;e.setTime(e.getTime()+60*o*60*1e3),r+=`; expires=${e.toUTCString()}`}document.cookie=r},o=(e,o)=>{let r=e.getAttribute("id");r=r.replace("popup-builder-","");const{entrAnimation:n,exitAnimation:s,animationDuration:p,type:a}=o||{},c=e.querySelector(".popup-builder-container");c.classList.remove(`${n}`),c.classList.add(`${s}`),c.classList.add("reverse"),setTimeout(()=>{["popup","full-screen"].includes(a)&&o?.preventScroll&&(document.body.style.overflow=""),e.classList.remove("popup-builder-modal--open"),c.classList.remove(`${s}`),c.classList.remove("reverse"),t(`pbb_closed_${r}`,"true",8760),e.remove()},1e3*p)},r=function(e){const t=`; ${document.cookie}`.split(`; ${e}=`);return 2===t.length?t.pop().split(";").shift():null},n=window.wp.apiFetch;var s=e.n(n);const p=()=>window.parent.location.search.includes("preview=true")||window.parent.location.search.includes("subpage=templates"),a=async(e,o)=>{if(e&&!r(`pbb_conversion_${o}`)&&!p()){const e=Number(sessionStorage.getItem("pbb_logs"));await s()({path:"/pbb/v1/popup/logs",method:"PUT",data:{id:e,converted:!0,refferer:window.parent.document.referrer}}).then(e=>{"success"===e.status?t(`pbb_conversion_${o}`,"true",8760):console.error("Error updating conversion count:",e.message)})}},c=e=>{const t=JSON.parse(e.getAttribute("data-settings"));return{popupID:e.getAttribute("id").replace("popup-builder-",""),popupAttributes:t}},i=window.wp.url,l=window.wp.hooks,u=(e,t)=>{const o=document.querySelector(e);if(!o)return;const r=document.createElement("div");r.innerHTML=t.trim(),o.innerHTML="",Array.from(r.childNodes).forEach(e=>{o.appendChild(e)});const n=document.querySelector(".popup-builder-coupon-code-wrapper");n?.addEventListener("click",()=>{const e=n.querySelector(".popup-builder-coupon-code-text"),t=e.textContent;(async e=>{try{await navigator.clipboard.writeText(e)}catch{const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.select();try{document.execCommand("copy")}catch(e){console.error("Copy failed",e)}document.body.removeChild(t)}})(t).then(()=>{e.textContent="COPIED!",setTimeout(()=>e.textContent=t,3e3)})})},d=e=>e.closest(".pbb-form__field").querySelector(".error-message"),m=(e,t,o="client-error")=>{const r=document.createElement("div");r.classList.add("error-message"),r.textContent=t,r.id=o,e.parentElement.insertAdjacentElement("afterend",r)},b=(e,t,o)=>{const r=t(e.value),n=d(e);r?n&&n.remove():(n||m(e,`Please enter a valid ${o}`),e.focus())};var f;f="form",window.addEventListener("load",()=>{window[`__POPUPKIT_${f.toUpperCase()}_INIT`]||(window[`__POPUPKIT_${f.toUpperCase()}_INIT`]=!0,(()=>{const e=document.querySelectorAll(".pbb-form");if(!e.length)return;const t=document.querySelector('[data-block="popup-builder-block/coupon-wheel"]'),n=document.querySelector('[data-block="popup-builder-block/step"]');for(const f of e){const e=f.querySelector('input[type="email"]'),y=f.querySelector('input[type="tel"]'),w=f.querySelector(".pbb-form__submit-btn"),v=JSON.parse(f.getAttribute("data-settings")),{action:h,redirectURL:_,email:S,phone:g,copyText:C,newWindowURL:q,closeCampaign:k,istrackConversion:$,integration:x,message:T,closeCampaignDelay:A=3,step:L}=v||{},E=f.closest(".popup-builder-modal"),{popupID:P,popupAttributes:I}=c(E),N=Array.from(f.querySelectorAll("[required]"));f.addEventListener("submit",async c=>{c.preventDefault();for(const e of N){const t=d(e);if(e.value)t&&t.remove();else{if(t)continue;m(e,"This field is required"),e.focus()}}e&&b(e,i.isEmail,"email"),y&&b(y,i.isPhoneNumber,"phone number");const O=f.querySelector(".error-message");if(O&&"server-error"!==O.id)return;O&&"server-error"===O.id&&O.remove();const D=document.createElement("span");D.classList.add("pbb-form-loader"),w.append(D),w.querySelector(".btn-text").style.opacity=0;const U=new FormData(f,w),F={popup_id:P,form_data:{},user_data:r("pbb_user_info")||{}};for(const[e,t]of U)"email"!==e&&"name"!==e?F.form_data[e]?Array.isArray(F.form_data[e])?F.form_data[e].push(t.trim()):F.form_data[e]=[F.form_data[e],t.trim()]:F.form_data[e]=t.trim():F[e]=t.trim();let H=!1;if(x){const e=["mailchimp","fluentCRM","activeCampaign","zapier","hubspot","pabbly","aweber","zoho","convertKit","webhook","mailpoet","mailerlite","klaviyo","getResponse","brevo","omnisend","drip","slack"];for(const t of e)x?.[t]&&(F[t]=x[t],H=!0)}if(H&&(F.third_party_integration=!0),"true"===sessionStorage.getItem(`pbb_submitted_${P}`))return w.querySelector(".pbb-form-loader").remove(),w.querySelector(".btn-text").style.opacity=1,f.querySelector(".pbb-form-success")?.remove(),void m(w,"You have already submitted this form.");let M=null;t&&((0,l.doAction)("popup.triggerSpinWheel",!0),M=await new Promise(e=>{(0,l.addAction)("popup.wheelSpinCompleted","pbb/spinCompleteHandler",t=>{e(t),(0,l.removeAction)("popup.wheelSpinCompleted","pbb/spinCompleteHandler")})}));const R=(0,l.applyFilters)("popup.wheelCouponCode",null,!0);M&&!n&&u(".wp-block-popup-builder-block-form",`\n\t\t\t\t\t<div class="popup-builder-coupon-wheel-result">\n      \t\t\t\t\t<h1 class="popup-builder-coupon-wheel-title">${R?.success?.wheelSuccessMessage}</h1>\n      \t\t\t\t\t<p class="popup-builder-coupon-wheel-description">${R?.success?.wheelSuccessDescription}</p>\n      \t\t\t\t\t<div class="popup-builder-coupon-code-wrapper">\n      \t\t\t\t\t\t<span class="popup-builder-coupon-code-label">${R?.success?.wheelCouponCodeLabel}</span>\n        \t\t\t\t\t<span class="popup-builder-coupon-code-text">${R?.couponCode}</span>\n      \t\t\t\t\t</div>\n    \t\t\t\t</div>\n \t\t \t\t\t`);const V=async e=>{w.querySelector(".pbb-form-loader").remove(),w.querySelector(".btn-text").style.opacity=1;const t=window.getComputedStyle(w).getPropertyValue("position"),r=document.createElement("div");r.className="pbb-form-success",r.textContent=T,"absolute"===t?f.querySelector(".pbb-form__field-0").append(r):w.parentElement.append(r),f.reset(),w.disabled=!0,e&&(sessionStorage.setItem(`pbb_submitted_${P}`,"true"),await a($,P)),k&&setTimeout(()=>{o(E,I)},1e3*A),(()=>{switch(h){case"redirect-url":window.location.href=_;break;case"email":window.location.href=`mailto:${S}`;break;case"call":window.location.href=`tel:${g}`;break;case"copy-text":navigator.clipboard.writeText(C);break;case"new-window":window.open(q,"_blank");break;case"step":const e=(0,l.applyFilters)("popupkit.steps.form",""),t=document.querySelectorAll(".wp-block-popup-builder-block-step");for(const e of t)e.classList.contains("active")&&e.classList.remove("active");const o=e[parseInt(L)];if(o.classList.add("active"),n&&n){const e=document.createTreeWalker(o,NodeFilter.SHOW_TEXT,null,!1);for(;e.nextNode();){const t=e.currentNode;t.nodeValue.includes("{{coupon_code}}")&&(t.nodeValue=t.nodeValue.replace("{{coupon_code}}",R?.couponCode))}}document.querySelector(".popupkit-steps-inner").insertBefore(o,t[parseInt(v.step)])}})()};p()?V(!1):s()({path:"/pbb/v1/subscribers",method:"POST",body:JSON.stringify(F)}).then(e=>{"error"===e.status?(w.querySelector(".pbb-form-loader").remove(),w.querySelector(".btn-text").style.opacity=1,f.querySelector(".pbb-form-success")?.remove(),m(w,e.message,"server-error")):V(!0)})})}})())})})();