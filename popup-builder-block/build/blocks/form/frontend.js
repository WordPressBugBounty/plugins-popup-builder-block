(()=>{"use strict";var e={n:t=>{var o=t&&t.__esModule?()=>t.default:()=>t;return e.d(o,{a:o}),o},d:(t,o)=>{for(var r in o)e.o(o,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:o[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=(e,t)=>{let o=e.getAttribute("id");o=o.replace("popup-builder-","");const{entrAnimation:r,exitAnimation:i,animationDuration:n,type:s}=t||{},a=e.querySelector(".popup-builder-container");a.classList.remove(`${r}`),a.classList.add(`${i}`),a.classList.add("reverse"),setTimeout((()=>{["popup","full-screen"].includes(s)&&t?.preventScroll&&(window.parent.document.body.style.overflow=""),e.classList.remove("popup-builder-modal--open"),a.classList.remove(`${i}`),a.classList.remove("reverse"),window.frameElement&&window.frameElement.remove()}),1e3*n)},o=function(e){const t=`; ${document.cookie}`.split(`; ${e}=`);return 2===t.length?t.pop().split(";").shift():null},r=window.wp.apiFetch;var i=e.n(r);const n=(e,t)=>{e&&!o(`pbb_conversion_${t}`)&&((e,t)=>{const o=Number(sessionStorage.getItem("pbb_logs"));i()({path:"/pbb/v1/popup/logs",method:"PUT",data:{id:o,...e}}).then((e=>{t&&t(e)}))})({converted:!0,refferer:window.parent.document.referrer},(e=>{"success"===e.status?function(e,t,o){const r=new Date;r.setTime(r.getTime()+60*o*60*1e3);const i=`expires=${r.toUTCString()}`;document.cookie=`${e}=${t}; ${i}; path=/`}(`pbb_conversion_${t}`,"true",8760):console.error("Error updating conversion count:",e.message)}))},s=e=>{const t=JSON.parse(e.getAttribute("data-settings"));return{popupID:e.getAttribute("id").replace("popup-builder-",""),popupAttributes:t}},a=/^(mailto:)?[a-z0-9._%+-]+@[a-z0-9][a-z0-9.-]*\.[a-z]{2,63}$/i;function p(e){return a.test(e)}const l=/^(tel:)?(\+)?\d{6,15}$/;function c(e){return e=e.replace(/[-.() ]/g,""),l.test(e)}window.addEventListener("load",(()=>{const e=document.querySelectorAll(".pbb-form");if(e.length)for(const r of e){const e=r.querySelector('input[type="email"]'),a=r.querySelector('input[type="tel"]'),l=r.querySelector(".pbb-form__submit-btn"),u=JSON.parse(r.getAttribute("data-settings")),{action:d,redirectURL:m,email:b,phone:f,copyText:y,newWindowURL:v,closeCampaign:g,istrackConversion:w,integration:h,message:_}=u||{},S=r.closest(".popup-builder-modal"),{popupID:$,popupAttributes:q}=s(S),I=Array.from(r.querySelectorAll("[required]")),A=e=>e.closest(".pbb-form__field").querySelector(".error-message"),C=(e,t)=>{const o=document.createElement("div");o.classList.add("error-message"),o.textContent=t,e.parentElement.insertAdjacentElement("afterend",o)},L=(e,t,o)=>{const r=t(e.value),i=A(e);r?i&&i.remove():(i||C(e,`Please enter a valid ${o}`),e.focus())};r.addEventListener("submit",(async s=>{s.preventDefault();for(const e of I){const t=A(e);if(e.value)t&&t.remove();else{if(t)continue;C(e,"This field is required"),e.focus()}}if(e&&L(e,p,"email"),a&&L(a,c,"phone number"),r.querySelector(".error-message"))return;const u=document.createElement("span");u.classList.add("pbb-form-loader"),l.append(u);const E=new FormData(r,l),K={popup_id:$,form_data:{},user_data:o("pbb_user_info")||{}};for(const[e,t]of E)"email"!==e&&"name"!==e?K.form_data[e]=t.trim():K[e]=t.trim();let O=!1;if(h){if(h?.mailchimp){const{apiKey:e,listId:t,doubleOptin:o}=h.mailchimp;K.mailchimp={apiKey:e,listId:t,doubleOptin:o},O=!0}if(h?.fluentCRM){const{apiKey:e}=h.fluentCRM;K.fluentCRM={apiKey:e},O=!0}if(h?.activeCampaign){const{apiKey:e,listId:t}=h.activeCampaign;K.activeCampaign={apiKey:e,listId:t},O=!0}if(h?.zapier){const{apiKey:e,listId:t}=h.zapier;K.zapier={apiKey:e,listId:t},O=!0}if(h?.hubspot){const{apiKey:e,listId:t}=h.hubspot;K.hubspot={apiKey:e,listId:t},O=!0}}if(O&&(K.third_party_integration=!0),"true"===sessionStorage.getItem(`pbb_submitted_${$}`))return l.querySelector(".pbb-form-loader").remove(),r.querySelector(".pbb-form-success")?.remove(),void C(l,"You have already submitted this form.");i()({path:"/pbb/v1/subscribers",method:"POST",body:JSON.stringify(K)}).then((e=>{l.querySelector(".pbb-form-loader").remove();const o=window.getComputedStyle(l).getPropertyValue("position"),i=document.createElement("div");switch(i.className="pbb-form-success",i.textContent=_,"absolute"===o?r.querySelector(".pbb-form__field-0").append(i):l.parentElement.append(i),sessionStorage.setItem(`pbb_submitted_${$}`,"true"),r.reset(),l.disabled=!0,g&&t(S,q),n(w,$),d){case"redirect-url":window.location.href=m;break;case"email":window.location.href=`mailto:${b}`;break;case"call":window.location.href=`tel:${f}`;break;case"copy-text":navigator.clipboard.writeText(y);break;case"new-window":window.open(v,"_blank")}}))}))}}))})();